<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="/WEB-INF/templates/admin.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:my="http://java.sun.com/jsf/composite/components">
    <ui:define name="content">
        <h:outputStylesheet name="app.css" library="css"/>
        <h:outputScript target="head" name="showMessage.js" library="js"/>

        <h1>Welcome to JBoss!</h1>

        <div>
            <p>You have successfully deployed a RichFaces web application.</p>

            <h3>Your application can run on:</h3>
            <h:graphicImage library="gfx" name="dualbrand_as7eap.png"/>
        </div>

       <h:form id="reg">
          <rich:panel id="newConferencePanel" styleClass=".form" header="Conference Registration" headerClass="header">
              <p>Enforces annotation-based constraints defined on the model class.</p>

              <my:conferenceForm id="conferenceForm" conference="#{newConference}"/>

             <h:panelGrid columns="2">
                <a4j:commandButton id="register" action="#{conferenceController.register}" value="Register"
                                   styleClass="register" execute="newConferencePanel" render="newConferencePanel"/>
                <rich:messages globalOnly="true"/>
             </h:panelGrid>
          </rich:panel>
          <br />

          <div id="newConferenceMessages" class="update"/>

          <rich:collapsiblePanel id="conferenceList" header="Conferences" headerClass="header" title="Click to expand/collapse">
             <h:panelGroup rendered="#{empty conferences}">
                <em>No registered conferences.</em>
             </h:panelGroup>
             <rich:dataTable id="conferenceTable" var="_conference" value="#{conferences}" rendered="#{not empty conferences}" style="width : 100%">
                   <rich:column id="view">
                      <a4j:commandLink styleClass="no-decor" render="conferencePanel" execute="@this"
                                       oncomplete="#{rich:component('conferencePopup')}.show()">
                         View
                         <f:setPropertyActionListener target="#{conferenceController.conference}" value="#{_conference}"/>
                      </a4j:commandLink>
                   </rich:column>
                   <rich:column id="conference_id">
                      <f:facet name="header">Id</f:facet>
                      #{_conference.id}
                   </rich:column>
                   <rich:column id="conference_name">
                      <f:facet name="header">Name</f:facet>
                      #{_conference.name}
                   </rich:column>
                   <rich:column id="conference_description">
                      <f:facet name="header">Description</f:facet>
                      #{_conference.description}
                   </rich:column>
                   <rich:column id="conference_location">
                      <f:facet name="header">Location</f:facet>
                      #{_conference.location}
                   </rich:column>
                   <rich:column id="conference_rest_url">
                      <f:facet name="header">REST URL</f:facet>
                      <a href="#{request.contextPath}/rest/conferences/#{_conference.id}" target="_rest_conference">/rest/conferences/#{_conference.id}</a>
                   </rich:column>
                   <f:facet name="footer">
                      REST URL for all conferences: <a href="#{request.contextPath}/rest/conferences" target="_rest_all">/rest/conferences</a>
                   </f:facet>
                </rich:dataTable>
          </rich:collapsiblePanel>

          <rich:popupPanel id="conferencePopup" modal="true" onmaskclick="#{rich:component('conferencePopup')}.hide()"
                           domElementAttachment="form" autosized="true">
             <f:facet name="header">
                <h:outputText value="Conference Details"/>
             </f:facet>
             <f:facet name="controls">
                <h:outputLink value="#" onclick="#{rich:component('conferencePopup')}.hide(); return false;">
                   X
                </h:outputLink>
             </f:facet>
             <h:panelGroup id="conferencePanel">
                <my:conferenceForm conference="#{conference}"/>
             </h:panelGroup>
          </rich:popupPanel>

          <a4j:push address="pushCdi" ondataavailable="showMessage(event.rf.data)">
             <a4j:ajax event="dataavailable" render="conferenceList" />
          </a4j:push>

       </h:form>
    </ui:define>
</ui:composition>
